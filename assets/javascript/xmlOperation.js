var lastAction;function xmlTojson(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),n=e.getValue();if(0<n.trim().length)try{if("undefined"==typeof X2JS)return void $.loadScript("https://cdnjs.cloudflare.com/ajax/libs/x2js/1.2.0/xml2json.min.js",function(){xmlTojson()});var l=new X2JS;o=vkbeautify.json(l.xml_str2json(n)),lastAction="xmlTojson",isJsonData=!0,t.getSession().setMode("ace/mode/json"),$("#json").hide(),t.getSession().setUseWrapMode(!0),t.setValue(o)}catch(n){console.log(n),0!="".length&&openErrorDialog("invalid XML")}}function xmlValidator(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),o=new DOMParser,n=e.getValue(),l=o.parseFromString(n,"text/xml").getElementsByTagName("parsererror");if(l.length){var a=l[0].textContent;return a=(a=a.replace("This page contains the following errors:","")).replace("Below is a rendering of the page up to the first error.",""),t.getSession().setMode("ace/mode/text"),t.setValue("Invalid XML","Parse error(s) below."),a}return t.getSession().setMode("ace/mode/text"),lastAction="xmlValidator",t.setValue("This XML document is perfectly valid.")}function xmlbeautify(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),o=e.getValue();t.getSession().setMode("ace/mode/xml");var n=vkbeautify.xml(o,"\t");return lastAction="xmlbeautify",t.setValue(n)}function xmlminify(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),o=e.getValue(),n=vkbeautify.xmlmin(o);return t.getSession().setMode("ace/mode/xml"),lastAction="xmlminify",t.setValue(n)}function xmlTocsv(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),o=e.getValue(),n=(new X2JS).xml_str2json(o);n=n[Object.keys(n)[0]];var l=[];l=[];for(var a in n){var i=n[a];if(i instanceof Array)for(var r=0;r<i.length;r++)l.push(i[r]);else"object"==typeof i&&l.push(i)}var s=Papa.unparse(l);return t.getSession().setMode("ace/mode/text"),lastAction="xmlTocsv",t.setValue(s)}function xmlToBase64(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),o=e.getValue(),n=btoa(unescape(encodeURIComponent(o)));t.getSession().setMode("ace/mode/text"),lastAction="xmlToBase64",t.setValue(n)}function xmlToPlainText(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),o=e.getValue(),n=(new X2JS).xml_str2json(o);return t.getSession().setMode("ace/mode/text"),lastAction="xmlToPlainText",t.setValue(jsonToText(n))}function jsonToText(e){var t="";if("object"==typeof e)if(e instanceof Array)for(var o in e)t+=jsonToText(e[o]);else for(var o in e){var n=e[o];t+="object"==typeof n?o+"\n"+jsonToText(n):o+" "+jsonToText(n)}else t+=e.toString()+"\n";return t}function xmlToTsv(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),o=xml_to_tsv(e.getValue());return t.getSession().setMode("ace/mode/text"),lastAction="xmlToTsv",t.setValue(o)}function xml_to_tsv(e){var t=(new X2JS).xml_str2json(e),o=Object.keys(t);if(o.length>1)throw new Error("XML contains multiple primary keys. Too complex to convert to TSV.");var n=o[0];if("string"==typeof t[n]||"number"==typeof t[n])return n+"\n"+t[n];if("object"==typeof t[n]){var l=Object.keys(t[n]);if(1==l.length){var a=l[0];if("string"==typeof t[n][a]||"number"==typeof t[n][a])return n+"\n"+t[n][a];if(t[n][a]instanceof Array){if("string"==typeof t[n][a][0]||"number"==typeof t[n][a][0]){for(var i=n+"\n",r=0;r<t[n][a].length;r++)i+=t[n][a][r]+"\n";return i}if("object"==typeof t[n][a][0]){for(i=(c=Object.keys(t[n][a][0])).join("\t")+"\n",r=0;r<t[n][a].length;r++){for(var s=0;s<c.length;s++)i+=t[n][a][r][c[s]]+"\t";i+="\n"}return i}throw new Error("xml too complex to convert to tsv, or something went wrong")}if("object"==typeof t[n][a]){var c;for(i=(c=Object.keys(t[n][a])).join("\t")+"\n",r=0;r<c.length;r++)i+=t[n][a][c[r]]+"\t";return i}throw new Error("xml too complex to convert to tsv, or something went wrong")}i=l.join("\t")+"\n";for(r=0;r<l.length;r++)i+=t[n][l[r]]+"\t";return i}throw new Error("xml too complex to convert to tsv, or something went wrong")}function convertToHtml(){var t=ace.edit("editor").getValue(),o=null;if(null!=t&&0!=t.length)if("json"==t.toLowerCase())o=jsonTocsvbyjson(t,!0),toHTML(o,t);else if("xml"==t.toLowerCase()){if("undefined"==typeof X2JS)return void $.loadScript("https://cdnjs.cloudflare.com/ajax/libs/x2js/1.2.0/xml2json.min.js",function(){convertToHtml(t)});var n=new X2JS;try{t=$.parseXML(t)}catch(e){openErrorDialog("Invalid XML")}var l=n.xml2json(t);editorOutput.getSession().setMode("ace/mode/html"),o=editorOutput.setValue(jsonTocsvbyjson(l,!0),toHTML(o,e))}}function xmlToYaml(){var e=ace.edit("editor"),t=ace.edit("editorOutput"),o=e.getValue(),n=(new X2JS).xml_str2json(o);if(null==n)return""!=o&&t.setValue("Can't convert.","XML is invalid."),"";var l=YAML.stringify(n);return t.getSession().setMode("ace/mode/yaml"),lastAction="xmlToYaml",t.setValue(l)}function sampleFile(){editor.setValue('<?xml version="1.0" encoding="UTF-8" ?>\n<employees>\n   <employee>\n     <id>1</id>\n     <firstName>Leonardo</firstName>\n     <lastName>DiCaprio</lastName>\n   </employee>\n</employees>'),xmlbeautify()}function inputCopyContent(){if("none"==document.getElementById("clipboard-content").style.display){document.getElementById("clipboard-content").style.display="block";var e=document.querySelector("#clipboard-content");e.value=editor.getValue(),e.select(),document.execCommand("copy"),e.value="",document.getElementById("clipboard-content").style.display="none"}}function outputCopyContent(){if("none"==document.getElementById("clipboard-content").style.display){document.getElementById("clipboard-content").style.display="block";var e=document.querySelector("#clipboard-content");e.value=editorOutput.getValue(),e.select(),document.execCommand("copy"),e.value="",document.getElementById("clipboard-content").style.display="none"}}function downloadFile(){var e=editorOutput.getValue();if(null!=lastAction){var t=new Blob([e],{type:"text/plain;charset=utf-8"});console.log(lastAction),"xmlTojson"==lastAction?saveAs(t,"xmlonline.json"):"xmlValidator"==lastAction?saveAs(t,"xmlonline.txt"):"xmlbeautify"==lastAction?saveAs(t,"xmlonline.xml"):"xmlminify"==lastAction?saveAs(t,"xmlonline.xml"):"xmlTocsv"==lastAction?saveAs(t,"xmlonline.csv"):"xmlToBase64"==lastAction?saveAs(t,"xmlonline.txt"):"xmlToPlainText"==lastAction?saveAs(t,"xmlonline.txt"):"xmlToTsv"==lastAction?saveAs(t,"xmlonline.tsv"):"xmlToYaml"==lastAction&&saveAs(t,"xmlonline.yaml")}else editorOutput.setValue("Your Result is Empty.")}function clearInputAndOutput(){editor.setValue(""),editorOutput.setValue("")}function clearOutput(){editorOutput.setValue("")}